<?php ?>
<script type='text/javascript'>
                var posX ;
		var posY ;
		var grid ;
		var map  ;
               

function get_player(){
	
		var a = new Request.JSON({
			url: "index.php?option=com_battle&format=raw&task=action&action=get_player",
			onSuccess: function(result){
			
			alert(result[3]);
			
			
		posX = result[0];
		posY = result[1];
		grid = result[2];
		map = result[3];
			
				}
			}).get();



jump(posX,posY,grid,map);

			
}



function get_players(){
 
  var a = new Request.JSON({
  url: "index.php?option=com_battle&task=action&action=heartbeat&format=raw",
  onSuccess: function(result){
	  for (i = 0; i < result.length; i ++ ){
		//  if($('screen_grid').hasChild('char_' + result[i].iduser ))
		//	  {
			  Move_Char(result[i].iduser,result[i].posx,result[i].posy)
		//	  }
		  }
	  }
  }).get();
  }
  

function Move_Char(iduser,px,py){

   var mover2 = new Fx.Move($('char_' + iduser), {
    relativeTo: document.getElementById('screen_grid'),
    position: 'upperLeft',
    edge: 'upperLeft',
    offset: {x:px*50, y: py*50}
    });
    
      
mover2.start(); //moves to the new location
}





function Move_Player(){
 
  var a = new Request.JSON({
    url: "index.php?option=com_battle&format=raw&task=action&action=save_coordinate&posx=" + PosX + "&posy=" + PosY + "&grid=" + grid + "&map=" + map, 
    onSuccess: function(){ 
    var mover = new Fx.Move($('demo'), {
    relativeTo: document.getElementById('screen_grid'),
    position: 'upperLeft',
    edge: 'upperLeft',
  offset: {x: pX, y: pY}
  });
  
 mover.start(); //moves to the new location

  }
   }).get();
 		
}

function Move_Player_not_calling_server(){
    var mover = new Fx.Move($('demo'), {
    relativeTo: document.getElementById('screen_grid'),
    position: 'upperLeft',
    edge: 'upperLeft',
  offset: {x: pX, y: pY}
  });
  
 mover.start(); //moves to the new location

  }






function MoveUp(){

		if(map==30 && PosX==4 && PosY==0){
			portal=1;
			grid=1;
			map=3;
			PosX=4;
			PosY=7;

					jump();
			return;
				}
				
				
		if(map==31 && PosX==4 && PosY==0){
			portal=10;
			grid=10;
			map=4;
			PosX=4;
			PosY=7;

					jump();
			return;
				}

	if (PosY==0){
		PosY=7;
		map=map - grid_index;
		jump();
		return;
		}
		if(cell[PosX][PosY-1]<=0){
			PosY=PosY-1;
			pY=pY-50;
			Move_Player();
		
			return	false;
			}
			else {
				walls_alert();
				}
			}

function MoveDown(){


		if(map==3 && PosX==4 && PosY==7){
			portal=9;
			grid=9;
			map=30;
			PosX=4;
			PosY=0;

					jump();
			return;
				}

		if(map==4 && PosX==4 && PosY==7){
			portal=10;
			grid=10;
			map=31;
			PosX=4;
			PosY=0;

					jump();
			return;
				}

	if (PosY==7){
		PosY=0;
		map=map+grid_index;
		jump();
		return;
		}
		
		if(cell[PosX][PosY+1]<=0){
			PosY=PosY+1;
			pY=pY+50;
			Move_Player();
		
			return	false;		
			}
			else {
				walls_alert();
				}
			}
			
function MoveLeft(){
	

		if(map==6 && PosX==0 && PosY==6){
			portal=1;
			grid=1;
			map=4;
			PosX=7;
			PosY=6;

					jump();
			return;
				}
				
				
		if(map==10 && PosX==0 && PosY==6){
			portal=1;
			grid=2;
			map=6;
			PosX=7;
			PosY=6;

					jump();
			return;
				}	
				
		if(map==18 && PosX==0 && PosY==4){
			portal=1;
			grid=3;
			map=15;
			PosX=7;
			PosY=4;

					jump();
			return;
				}					
				
			if(map==20 && PosX==0 && PosY==6){
			portal=4;
			grid=4;
			map=19;
			PosX=7;
			PosY=6;

					jump();
			return;
				}					
			
			
			
					if(map==21 && PosX==0 && PosY==1){
			portal=5;
			grid=5;
			map=20;
			PosX=7;
			PosY=1;

					jump();
			return;
				}			
			
					if(map==25 && PosX==0 && PosY==1){
			portal=6;
			grid=6;
			map=22;
			PosX=7;
			PosY=1;

					jump();
			return;
				}
				
				
			
					if(map==25 && PosX==0 && PosY==5){
			portal=6;
			grid=6;
			map=22;
			PosX=7;
			PosY=5;

					jump();
			return;
				}
							
				
			
					if(map==27 && PosX==0 && PosY==2){
			portal=6;
			grid=6;
			map=24;
			PosX=7;
			PosY=2;

					jump();
			return;
				}			
					if(map==29 && PosX==0 && PosY==2){
			portal=6;
			grid=7;
			map=26;
			PosX=7;
			PosY=2;

					jump();
			return;
				}
			
			
			
		
	if (PosX==0){
		PosX=7;
		map=map-1;
				jump();
		return;
		}
		
		
		
		
	if(cell[PosX-1][PosY]<=0){
	PosX=PosX-1;
	pX=pX-50;
	Move_Player();
	
	return false;
	}
	else {
		walls_alert();
		}
}










function MoveRight (){
	
	if(map==4 && PosX==7 && PosY==6){
		portal=1;
		grid=2;
		map=6;
		PosX=0;
		PosY=6;
				jump();
		return;

			}
	

	if(map==6 && PosX==7 && PosY==6){
		portal=2;
		grid=3;
		map=10;
		PosX=0;
		PosY=6;
				jump();
		return;

			}		
			
		if(map==15 && PosX==7 && PosY==4){
		portal=3;
		grid=4;
		map=18;
		PosX=0;
		PosY=4;
				jump();
		return;

			}	
			


		if(map==19 && PosX==7 && PosY==6){
		portal=4;
		grid=5;
		map=20;
		PosX=0;
		PosY=6;
				jump();
		return;

			}			
	
			if(map==20 && PosX==7 && PosY==1){
		portal=5;
		grid=6;
		map=21;
		PosX=0;
		PosY=1;
				jump();
		return;

			}	
			
			
			
			if(map==22 && PosX==7 && PosY==1){
		portal=6;
		grid=7;
		map=25;
		PosX=0;
		PosY=1;
				jump();
		return;

			}			
			
			
			if(map==22 && PosX==7 && PosY==5){
		portal=6;
		grid=7;
		map=25;
		PosX=0;
		PosY=5;
				jump();
		return;

			}			
			
			if(map==24 && PosX==7 && PosY==2){
		portal=6;
		grid=7;
		map=27;
		PosX=0;
		PosY=2;
				jump();
		return;

			}
				
				
				if(map==26 && PosX==7 && PosY==2){
		portal=6;
		grid=8;
		map=29;
		PosX=0;
		PosY=2;
				jump();
		return;

			}
	
	
	
	
	
	
		
			
	if(PosX==7){
		PosX=0;
		map=map+1;
		alert (map);
   				jump(posX,posY,grid,map);
			return;
		}
		
		
		

	if(cell[PosX+1][PosY]<=0){
		PosX=PosX+1;
		pX=pX+50;
		Move_Player();
		
		return false;
		}
		else {
			walls_alert();
			}
}


			
				
				

function walls_alert(){
	alert('You cant walk through walls...... Yet!' );
	}

	

	
function jump(posX,posY,grid,map){


alert(map);


	location.href = 'index.php?option=com_battle&view=single&id=' + map + '&update=1&posx='+ PosX +'&posy=' + PosY + '&grid='+ grid;
}	
	



function shoot(character_id){
	var d = document.getElementById('shoot');

		var a = new Request.JSON({
			url: "index.php?option=com_battle&format=raw&task=action&action=attack&type=shoot&character=" + character_id,
			onSuccess: function(result){
			
			if (result[1] > 0 ) {
				
				alert('me: ' + result[0] + '   Him: ' + result[1]);
			}
			
			else {
				alert('me: ' + result[0] + '   Him: ' + result[1]);	
		close(); 
		get_player();
				
				
				}
				}
			}).get();
		
}

function kick(character_id){
	var d = document.getElementById('kick');
	
		var a = new Request.JSON({
			url: "index.php?option=com_battle&format=raw&task=action&action=attack&type=kick&character=" + character_id,
			onSuccess: function(result){
			
			if (result[1] > 0 ) {
				
				alert('me: ' + result[0] + '   Him: ' + result[1]);
			}
			
			else {
				alert('me: ' + result[0] + '   Him: ' + result[1]);	
		close();
				jump();
				
				}
				}
			}).get();
		
}

function punch(character_id){
	var d = document.getElementById('punch');
	
		var a = new Request.JSON({
			url: "index.php?option=com_battle&format=raw&task=action&action=attack&type=punch&character=" + character_id,
			onSuccess: function(result){
			
			if (result[1] > 0 ) {
				
				alert('me: ' + result[0] + '   Him: ' + result[1]);
			}
			
			else {
				alert('me: ' + result[0] + '   Him: ' + result[1]);	
		close();
				jump();
				
				}
				}
			}).get();
		
}







function attack_playa(player_id){
	var d = document.getElementById('attack');

		var a = new Request.JSON({
			url: "index.php?option=com_battle&format=raw&task=action&action=attack_playa&player=" + player_id,
			onSuccess: function(result){
			
			if (result[1] > 0 ) {
				
				alert('me: ' + result[0] + '   Him: ' + result[1]);
			}
			
			else {
				alert('me: ' + result[0] + '   Him: ' + result[1]);	
		close();
				jump();
				
				}
				}
			}).get();
		
}



function kick_playa(player_id){
	var d = document.getElementById('kick');
	d.onclick = function() {
		var a = new Request.JSON({
			url: "index.php?option=com_battle&format=raw&task=action&action=kick_playa&player=" + player_id,
			onSuccess: function(result){
			
			if (result[1] > 0 ) {
				
				alert('me: ' + result[0] + '   Him: ' + result[1]);
			}
			
			else {
				alert('me: ' + result[0] + '   Him: ' + result[1]);	
		close();
				jump();
				
				}
				}
			}).get();
		}
}






	</script>
