
<?php defined( '_JEXEC' ) or die( 'Restricted access' );
 
	$blueprints = $this->blueprints;
	
	
	
	//print_r($blueprints);
	
	
	
	
	
	$x=count($this->blueprints);
	$index= $x+1;
	$now=time();
	
 /*  $arr = new object;

           $arr[id] = 0;
           $arr[object] = 0;
           $arr[user_id] = 63;
           $arr[sell_price] = 1;
           $arr[name] = 'Select';
           $arr[description] = 'Select';
           $arr[metal_1] = 0;
           $arr[quantity_1] = 0;
           $arr[metal_2] = 0;
           $arr[quantity_2] = 0;
           $arr[metal_1_name] = 'Kryptonite';
           $arr[metal_2_name] = 'Carbon';
           $arr[metal_1_stock] = 0;
           $arr[metal_2_stock] = 0;
           
           */

   //        echo '<pre>';
  //        print_r($factories);
  //        echo '</pre>';
  //        exit();
           
//$factories = array_unshift_assoc( $factories , '' , $arr);

//$factories[$index]='Select';

	function array_unshift_assoc(&$arr, $key, $val)
	{
	$arr = array_reverse($arr, true);
	$arr[$key] = $val;
	return  array_reverse($arr, true);
	}
	$javascript			= 'onchange="changeDisplayImage(blueprints);"';
	$directory			= '/images/banners';
	$lists['blueprints']	=  JHTML::_('select.genericlist', $this->blueprints , 'blueprints',$javascript, 'id', 'name' );

?>

<div id="factory_noob" class="sample">
<div class="mask3">
<div id="box4">
<div>
<div id='conveyor_progress' style='visibility: hidden;'>
<p>
<label title="when manufactoring began">Started: </label><span id="since"></span></p>
<p>
<label>Current Time: </label><span id="now"><?php echo date('l jS \of F Y h:i:s A',$now) ; ?></span>
</p>
<div id="time_elapsed" class='wrapper sec'>
<label title="since manufactoring began">Time Elapsed: </label> <span id="elapsed"> </span> secs
</div>

<div id="time_remaining" class='wrapper sec'>
<label title="until manufactoring is complete">Time Remaining: </label>
<span id="remaining"> </span>secs
</div>

</div>
<!-- end of conveyor_progress -->
<h3>Conveyor 1</h3>
<?php
// print_r ($x);

?>
<form class="conveyor" action="index.php" method="get" name="adminForm" id="adminForm">

<fieldset class="object2">

<legend>Object</legend>

<input type="text" title="Object ID" name="id1" id="id1" value = "" size="2" style="width: 10px;" maxlength="2" 
readonly="readonly" />


<?php echo '' .  $lists['blueprints'] . '';?>


<label title="Quantity of Objects Required" for="quantity_adjust">qty:</label>

<input type="text" id="quantity_adjust" name="quantity_adjust" value="0" style="width:20px;" size="2" onchange="alterQuantity(this.form)" /> 

<input title="Increase Quantity" type="button" id="quantity_box_button_up" value="+" size="4" /> 

<input title="Decrease Quantity" type="button" id="quantity_box_button_down" value="-" size="4" /> 

<label title="Time To Manufacture Required" >Time:</label>
<input type="text" id="time" name="time" readonly='readonly' value="<?php echo $blueprints[0]->man_time ;?>" style="width:20px;" size="2" onchange="alterQuantity(this.form)" /> 

<span title="Start Reprocessing" id='submit_c'>Submit</span>

 <label title="In Stock" for="stock">In Stock:</label>
<input class="inputbox" type="text" size="4" maxlength="4" value="<?php echo $blueprints[0]->object_total ;?>" name="stock" id="stock"  style="width: 20px;" />


</fieldset>

<fieldset class="metal2">

						<legend title="What the object is made from">Material</legend>

<fieldset>
<label title="Type of Metal required" for="n1">Metal:</label> 
<input class="inputbox" type="text" size="4" maxlength="6" name="n1" id="n1" style="width: 70px;" value="<?php echo $blueprints[0]->metal_1_name ;?>" /> 

<label title="Units per Object" for="q1">units:</label> 
<input class="inputbox" type="text" size="1" maxlength="2" name="q1" id="q1" style="width: 20px;" value="<?php echo $blueprints[0]->quantity_1 ;?>" /> 

<label title="Total Units" for="q1t">total:</label>
 <input class="inputbox" type="text" size="1" maxlength="2"  name="q1t" id="q1t" style="width: 20px;" /> 


 </fieldset>

<fieldset>
<label title="Type of Metal required" for="n2">Metal:</label>
<input class="inputbox" type="text" size="4" maxlength="6" name="n2" id="n2" style="width: 70px;" value="<?php echo $blueprints[0]->metal_2_name ;?>" /> 
 
 
 <label title="Units per Object" for="q2" >units:</label>
  <input class="inputbox" type="text" size="1" maxlength="1" name="q2" id="q2" style="width: 20px;" value="<?php echo $blueprints[0]->quantity_2 ;?>" /> 

  
  <label title="Total Units" for="qt2" >total:</label>
<input class="inputbox" type="text" size="1" maxlength="2"  name="q2t" id="q2t" style="width: 20px;"  />




</fieldset>

					</fieldset>
					<input type="hidden" name="c" value="banner" /> 
					<input type="hidden" name="id" value="" /> 
					<input type="hidden"name="name" value="" /> 
					<input type="hidden" name="task" value="" />
				</form>

			</div>
			<div>
				<h3>Conveyor 2</h3>
				<div id="meter">

					<img src="/components/com_battle/images/meter01.jpg"><img
						src="/components/com_battle/images/meter01.jpg"><img
						src="/components/com_battle/images/meter01.jpg"><img
						src="/components/com_battle/images/meter01.jpg"><img
						src="/components/com_battle/images/meter01.jpg">
				</div>
				<!--end of meter-->
				<p>These conveyors will be enbled as the player's experience and
					wealth increase.</p>

			</div>

			<div>
				<h3>Conveyor 3</h3>
				<ul>
					<li>Number of Employees: 7</li>
					<li>Employees Morale: 70%</li>
					<li>Employee Efficiency: 95%</li>
				</ul>
				<p>These conveyors will be enbled as the player's experience and
					wealth increase.</p>
			</div>

			<div>
				<h3>Conveyor 4</h3>
				<img
					src="<?php echo $this->baseurl ?>/components/com_battle/includes/img4.jpg"
					alt="Photo" />
				<p>These conveyors will be enbled as the player's experience and
					wealth increase.</p>
			</div>

			<div>
				<h3>Conveyor 5</h3>
				<img
					src="<?php echo $this->baseurl ?>/components/com_battle/includes/img5.jpg"
					alt="Photo" />
				<p>These conveyors will be enbled as the player's experience and
					wealth increase.</p>

			</div>

			<div>
				<h3>Conveyor 6</h3>
				<img
					src="<?php echo $this->baseurl ?>/components/com_battle/includes/img6.jpg"
					alt="Photo" />
				<p>These conveyors will be enbled as the player's experience and
					wealth increase.</p>

			</div>

			<div>
				<h3>Conveyor 7</h3>
				<img
					src="<?php echo $this->baseurl ?>/components/com_battle/includes/img7.jpg"
					alt="Photo" />
				<p>These conveyors will be enbled as the player's experience and
					wealth increase.</p>

			</div>

			<div>
				<h3>Conveyor 8</h3>
				<img
					src="<?php echo $this->baseurl ?>/components/com_battle/includes/img8.jpg"
					alt="Photo" />
				<p>These conveyors will be enbled as the player's experience and
					wealth increase.</p>
			</div>

		</div>
	</div>
	<p class="buttons" id="handles4">
		<span title="Conveyor 1">C 1</span> <span title="Conveyor 2">C 2</span>
		<span title="Conveyor 3">C 3</span> <span title="Conveyor 4">C 4</span>
		<span title="Conveyor 5">C 5</span> <span title="Conveyor 6">C 6</span>
		<span title="Conveyor 7">C 7</span> <span title="Conveyor 8">C 8</span>
	</p>
</div>

<script type="text/javascript">

var metals = new Array();

request_metals();
prepare();
prepare2();
work_conveyer();
check_factory.periodical(5000);
 changeDisplayImage()
//noobslide


function prepare(){
	$('quantity_box_button_up').addEvent('click', function(){
		increment();
		});
	}

function prepare2(){
	$('quantity_box_button_down').addEvent('click', function(){
		decrement();
		});
	}



function increment(){
	var qty_el = document.getElementById('quantity_adjust'); 
	var qty = qty_el.value;
	
	if( !isNaN( qty )) qty_el.value++;

	var cost_el = document.getElementById('q1'); 
	var cost = cost_el.value;

	var cost_el_2	= document.getElementById('q2'); 
	var cost_2		= cost_el_2.value;

	var time		= <?php echo $blueprints[0]->man_time ;?>;
	
	document.adminForm.q1t.value = (cost * (parseInt(qty) + 1));
	document.adminForm.q2t.value = (cost_2 * (parseInt(qty) + 1));
	document.adminForm.time.value = (time * (parseInt(qty) + 1));	

	check_stock_control();

	return false;

	}

function decrement(){

	var qty_el = document.getElementById('quantity_adjust');
	var qty = qty_el.value ;
	
	if( !isNaN( qty ) && qty > 0 ) qty_el.value--;

	var cost_el = document.getElementById('q1');
	var cost = cost_el.value;

	var cost_el_2 = document.getElementById('q2');
	var cost_2 = cost_el_2.value;

	var time		= <?php echo $blueprints[0]->man_time ;?>;

	document.adminForm.q1t.value = cost * (qty-1);
	document.adminForm.q2t.value = cost_2 * (qty-1);
	document.adminForm.time.value = (time * (parseInt(qty) - 1));	
	
	check_stock_control();

	 return false;
	}

function work_conveyer() {
	$('submit_c').addEvent('click', function(){
		work();
		});
	}

function work(){
	var a = new Request.JSON({
		url: "index.php?option=com_battle&format=raw&task=work_reprocessor&quantity=" + document.adminForm.time.value + "&building_id=<?php echo $this->buildings->id ?>&line=1&type=" + document.adminForm.id1.value  ,
		onSuccess: function(result){
			$('adminForm').setStyle('visibility','hidden');
			$('conveyor_progress').setStyle('visibility','visible');
			}
	}).get();
	}




function changeDisplayImage() {
	var id1					= new Array();
	var metal_name_1		= new Array();
	var metal_name_2		= new Array();
	var object_quantity		= new Array();
	//var mystock1 = 0;
	//var mystock2 = 0; 
	var q_1 = new Array();
	var q_2 = new Array();			
			<?php 
			$i=1;
			foreach ($this->blueprints as $row){
			
			?>
			id1[<?php echo  $row->id ?>]="<?php echo $row->id ?>";

			q_1[<?php echo  $row->id ?>]="<?php echo $row->quantity_1 ?>";
			q_2[<?php echo  $row->id ?>]="<?php echo $row->quantity_2 ?>";
			
			metal_name_1[<?php echo  $row->id ?>]="<?php echo $row->metal_1_name ?>";
			metal_name_2[<?php echo  $row->id ?>]="<?php echo $row->metal_2_name ?>";
			
			object_quantity[<?php echo  $row->id ?>]="<?php echo $row->object_total ?>";
			
			
			<?php
			$i++ ; 
			 }
			?>
			if (document.adminForm.blueprints.value !='') {

				index = id1[document.adminForm.blueprints.value];

				document.adminForm.id1.value = id1[index];
				document.adminForm.q1.value = q_1[index];
				document.adminForm.n1.value = metal_name_1[index];
                document.adminForm.q2.value = q_2[index];
                document.adminForm.n2.value = metal_name_2[index]  ;
                document.adminForm.stock.value = object_quantity[index];
              //  document.adminForm.stock.value = 7;                  		
				i=0;

				Array.each(metals, function( ){
					if (metals[i].name == metal_name_1[index]) {
						
						mystock1 = metals[i].quantity;
						}
					if (metals[i].name == metal_name_2[index]) {
						
						mystock2 = metals[i].quantity;
						}
					i++;
					}); 


                	
                   // document.adminForm.stock2.value = mystock2;
                    check_stock_control();
                    }
            else {
                document.adminForm.imagelib.src='images/blank.png';
                }
            }
//          var nS4 = new noobSlide({
//			box: $('box4'),
//			items: $$('#box4 div'),
//			size: 640,
//			handles: $$('#handles4 span'),
//			onWalk: function(currentItem,currentHandle){
//				$('info4').set('html',currentItem.getFirst().innerHTML);
//				this.handles.removeClass('active');
//				currentHandle.addClass('active');
//			}
//		});

		
function test_rob(){
	alert();
	}

function check_factory(){
			var a = new Request.JSON({
			url: "index.php?option=com_battle&format=raw&task=check_factory&line=1&building=<?php echo $this->buildings->id ; ?>" , 
		    onSuccess: function(result){
			    document.getElementById('since').innerHTML = result['since'];
			    document.getElementById('now').innerHTML = result['now'];
			    document.getElementById('elapsed').innerHTML = result['elapsed'];
			    document.getElementById('remaining').innerHTML = result['remaining'];        
		        if (result['remaining'] <= 0){
			        $('adminForm').setStyle('visibility','visible');
				    $('conveyor_progress').setStyle('visibility','hidden');
				    }
			    }
		    }).get();
		    }

function request_metals(){
	var a = new Request.JSON({
    url: "index.php?option=com_battle&format=raw&task=action&action=get_metals2", 
    onSuccess: function(result){
    metals= result;
    }
    }).get();
}

function check_stock_control(){
//	if whats in stock is less than required total hide submit button and change background to red
//  else change to green and show submit

    var stck = document.getElementById('stock');
	var ct1 = parseInt(stck.value);

	

	var qy1 = document.getElementById('quantity_adjust');
	var q_y1 = parseInt(qy1.value);

	

 
//
//
//

	if ((ct1 < q_y1) )
		{
		$('stock').setStyle('background','red');
		
		$('submit_c').setStyle('visibility','hidden');
		}
	if((ct1 >= q_y1) )
		{
		$('stock').setStyle('background','black');
		
		$('submit_c').setStyle('visibility','visible');
		}
	}
</script>



<script type="text/javascript">

//SAMPLE 4 (walk to item)
		var nS4 = new noobSlide({
			box: $('box4'),
			items: $$('#box4 div'),
			size: 640,
			handles: $$('#handles4 span'),
			onWalk: function(currentItem,currentHandle){
				// $('info4').set('html',currentItem.getFirst().innerHTML);
				this.handles.removeClass('active');
				currentHandle.addClass('active');
			}
		});

</script>
		
		
		
